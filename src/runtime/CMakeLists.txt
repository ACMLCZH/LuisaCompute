set(LUISA_COMPUTE_RUNTIME_RTX_SOURCES
        rtx/aabb.h
        rtx/accel.cpp
        rtx/accel.h
        rtx/hit.h
        rtx/mesh.cpp
        rtx/mesh.h
        rtx/procedural_primitive.cpp
        rtx/procedural_primitive.h
        rtx/ray.h
        rtx/triangle.h)

set(LUISA_COMPUTE_RUNTIME_RASTER_SOURCES
        raster/app_data.h
        raster/depth_buffer.cpp
        raster/depth_buffer.h
        raster/raster.cpp
        raster/raster_scene.h
        raster/raster_shader.h
        raster/raster_state.h
        raster/vertex_attribute.h
        raster/viewport.h)

set(LUISA_COMPUTE_RUNTIME_RHI_SOURCES
        rhi/command.h
        rhi/command_encoder.cpp rhi/command_encoder.h
        rhi/device_interface.cpp rhi/device_interface.h
        rhi/pixel.cpp rhi/pixel.h
        rhi/resource.cpp rhi/resource.h
        rhi/sampler.h
        rhi/stream_tag.h)

set(LUISA_COMPUTE_RUNTIME_SOURCES
        bindless_array.cpp bindless_array.h
        buffer.cpp buffer.h
        buffer_arena.h
        command_list.cpp command_list.h
        context.cpp context.h
        depth_format.h
        device.cpp device.h
        dispatch_buffer.cpp dispatch_buffer.h
        event.cpp event.h
        image.cpp image.h
        mipmap.cpp mipmap.h
        shader.h
        stream.cpp stream.h
        swap_chain.cpp swap_chain.h
        volume.cpp volume.h
        ${LUISA_COMPUTE_RUNTIME_RTX_SOURCES}
        ${LUISA_COMPUTE_RUNTIME_RASTER_SOURCES}
        ${LUISA_COMPUTE_RUNTIME_RHI_SOURCES})

add_library(luisa-compute-runtime SHARED ${LUISA_COMPUTE_RUNTIME_SOURCES})
target_link_libraries(luisa-compute-runtime PUBLIC luisa-compute-ast luisa-compute-ir) # this is so broken, disable it for now

target_compile_definitions(luisa-compute-runtime PRIVATE LC_RUNTIME_EXPORT_DLL=1)
set_target_properties(luisa-compute-runtime PROPERTIES
        UNITY_BUILD ${LUISA_COMPUTE_ENABLE_UNITY_BUILD}
        OUTPUT_NAME lc-runtime)

luisa_compute_install(runtime SOURCES ${LUISA_COMPUTE_RUNTIME_SOURCES})
