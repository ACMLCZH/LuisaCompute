add_library(luisa-compute-ext INTERFACE)

set(MI_OVERRIDE OFF CACHE BOOL "" FORCE)
set(MI_XMALLOC ON CACHE BOOL "" FORCE)
set(MI_USE_CXX OFF CACHE BOOL "" FORCE)
set(MI_OSX_ZONE ON CACHE BOOL "" FORCE)
set(MI_BUILD_STATIC ON CACHE BOOL "" FORCE)
set(MI_BUILD_SHARED OFF CACHE BOOL "" FORCE)
set(MI_BUILD_OBJECT OFF CACHE BOOL "" FORCE)
set(MI_BUILD_TESTS OFF CACHE BOOL "" FORCE)
add_subdirectory(mimalloc)

set(SPDLOG_BUILD_SHARED ON CACHE BOOL "" FORCE)
set(SPDLOG_ENABLE_PCH ON CACHE BOOL "" FORCE)
add_subdirectory(spdlog)
set_target_properties(spdlog PROPERTIES UNITY_BUILD ON)
target_compile_definitions(spdlog PUBLIC FMT_CONSTEVAL=inline) # clang has problem with this consteval
target_link_libraries(luisa-compute-ext INTERFACE spdlog::spdlog)

add_library(xxhash INTERFACE)
target_include_directories(xxhash INTERFACE xxHash)
target_compile_definitions(xxhash INTERFACE XXH_INLINE_ALL)
target_link_libraries(luisa-compute-ext INTERFACE xxhash)

add_library(stduuid INTERFACE)
target_include_directories(stduuid INTERFACE stduuid/include)
target_compile_definitions(stduuid INTERFACE UUID_SYSTEM_GENERATOR=1)
if (WIN32)
elseif (APPLE)
    target_link_libraries(stduuid INTERFACE "-framework CoreFoundation")
else ()
    find_package(LibUUID REQUIRED)
    target_link_libraries(stduuid INTERFACE LibUUID::LibUUID)
endif ()
target_link_libraries(luisa-compute-ext INTERFACE stduuid)
